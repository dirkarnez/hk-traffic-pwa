(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver(e=>{for(const a of e)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function r(e){const a={};return e.integrity&&(a.integrity=e.integrity),e.referrerPolicy&&(a.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?a.credentials="include":e.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(e){if(e.ep)return;e.ep=!0;const a=r(e);fetch(e.href,a)}})();function l(s,t){const r=s.getTime(),n=t.getTime(),e=Math.abs(n-r),a=Math.floor(e/1e3),o=Math.floor(a/60),i=a%60;return{minutes:o,seconds:i}}const u=s=>fetch(s,{method:"GET",cache:"no-cache"}).then(t=>t.json()),m=s=>u(s).then(t=>t.data.filter(r=>!!r.eta).map(r=>{var n={company:"KMB",eta:new Date(Date.parse(r.eta)),dataTime:new Date(Date.parse(r.data_timestamp))};return n})),d=s=>u(s).then(t=>t.data.filter(r=>!!r.eta).map(r=>{var n={company:"Citybus",eta:new Date(Date.parse(r.eta)),dataTime:new Date(Date.parse(r.data_timestamp))};return n})),p=(s,t)=>Promise.all([s?m(s):Promise.resolve(null),t?d(t):Promise.resolve(null)]).then(r=>r.filter(n=>!!n).reduce((n,e)=>[...n,...e],[])),f=[{name:"116 - HH to Tak Oi",kmbURL:"https://data.etabus.gov.hk/v1/transport/kmb/eta/11B2034DDF30617A/116/1",citybusURL:"https://rt.data.gov.hk//v2/transport/citybus/eta/CTB/001475/116"},{name:"793 - TKL to TKO",kmbURL:null,citybusURL:"https://rt.data.gov.hk//v2/transport/citybus/eta/CTB/002917/793"},{name:"793 - Mikiki to TKO",kmbURL:null,citybusURL:"https://rt.data.gov.hk//v2/transport/citybus/eta/CTB/001573/793"},{name:"796X - TKO 先進製造業中心, 駿光街 to HH",kmbURL:null,citybusURL:"https://rt.data.gov.hk//v2/transport/citybus/eta/CTB/002927/796X"},{name:"796X - TKO 日出康城領都, 環保大道 to HH",kmbURL:null,citybusURL:"https://rt.data.gov.hk//v2/transport/citybus/eta/CTB/002928/796X"}];(s=>{s&&Promise.all(f.map(t=>p(t.kmbURL,t.citybusURL).then(r=>({routeName:t.name,vehicles:r})))).then(t=>{t.forEach(r=>{const n=document.createElement("details"),e=document.createElement("summary");n.open=!0,e.innerText=r.routeName;const a=document.createElement("ol");r.vehicles.sort((o,i)=>o.eta.getTime()-i.eta.getTime()).forEach(o=>{const i=document.createElement("li"),c=l(o.eta,o.dataTime);i.innerText=`[${c.minutes} mins ${c.seconds} secs] ${o.company}`,a.appendChild(i)}),n.appendChild(e),n.appendChild(a),s.appendChild(n)})})})(document.querySelector("#app"));
