(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))r(e);new MutationObserver(e=>{for(const a of e)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(e){const a={};return e.integrity&&(a.integrity=e.integrity),e.referrerPolicy&&(a.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?a.credentials="include":e.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(e){if(e.ep)return;e.ep=!0;const a=t(e);fetch(e.href,a)}})();function l(s,n){const t=s.getTime(),r=n.getTime(),e=Math.abs(r-t),a=Math.floor(e/1e3),o=Math.floor(a/60),c=a%60;return{minutes:o,seconds:c}}const i=s=>fetch(s,{method:"GET",cache:"no-cache"}).then(n=>n.json()),m=s=>i(s).then(n=>n.data.filter(t=>!!t.eta).map(t=>{var r={company:"KMB",eta:new Date(Date.parse(t.eta)),dataTime:new Date(Date.parse(t.data_timestamp))};return r})),u=s=>i(s).then(n=>n.data.filter(t=>!!t.eta).map(t=>{var r={company:"Citybus",eta:new Date(Date.parse(t.eta)),dataTime:new Date(Date.parse(t.data_timestamp))};return r})),d=(s,n)=>Promise.all([s?m(s):Promise.resolve(null),n?u(n):Promise.resolve(null)]).then(t=>t.filter(r=>!!r).reduce((r,e)=>[...r,...e],[])),p=[{name:"116 - HH to Tak Oi",kmbURL:"https://data.etabus.gov.hk/v1/transport/kmb/eta/11B2034DDF30617A/116/1",citybusURL:"https://rt.data.gov.hk//v2/transport/citybus/eta/CTB/001475/116"},{name:"793 - TKL to TKO",kmbURL:null,citybusURL:"https://rt.data.gov.hk//v2/transport/citybus/eta/CTB/002917/793"},{name:"793 - Mikiki to TKO",kmbURL:null,citybusURL:"https://rt.data.gov.hk//v2/transport/citybus/eta/CTB/001573/793"},{name:"796X - TKO 先進製造業中心, 駿光街 to HH",kmbURL:null,citybusURL:"https://rt.data.gov.hk//v2/transport/citybus/eta/CTB/002927/796X"},{name:"796X - TKO 日出康城領都, 環保大道 to HH",kmbURL:null,citybusURL:"https://rt.data.gov.hk//v2/transport/citybus/eta/CTB/002928/796X"}];(s=>{s&&Promise.all(p.map(n=>{const t=document.createElement("details"),r=document.createElement("summary");t.open=!0,r.innerText=n.name;const e=document.createElement("ol");return t.appendChild(e),t.appendChild(r),s.appendChild(t),d(n.kmbURL,n.citybusURL).then(a=>({routeName:n.name,vehicles:a,dom:{detailsElement:t,summaryElement:r,orderListElement:e}}))})).then(n=>{n.forEach(t=>{t.vehicles.sort((r,e)=>r.eta.getTime()-e.eta.getTime()).forEach(r=>{const e=document.createElement("li"),a=l(r.eta,r.dataTime);e.innerText=`[${a.minutes} mins ${a.seconds} secs] ${r.company}`,t.dom.orderListElement.appendChild(e)})})})})(document.querySelector("#app"));
